<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QR Code Scanner</title>
    <style>
        #videoBack, #videoFront {
            width: 100%; 
            max-width: 600px; 
            border: 1px solid black; 
            display: none; /* Sembunyikan video sampai dipanggil */
        }
        #result {
            margin-top: 10px;
            font-weight: bold; 
        }
        #photoContainer {
            display: none; /* Sembunyikan container foto */
            margin-top: 10px;
        }
        img {
            max-width: 100%;
            height: auto;
        }
        a {
            display: block;
            margin-top: 10px;
            font-weight: bold;
            color: blue;
        }
    </style>
</head>
<body>

    <h1>QR Code Scanner</h1>
    <video id="videoBack" autoplay></video>
    <video id="videoFront" autoplay></video>
    <div id="result">Scan result will appear here</div>
    <div id="photoContainer">
        <h2>Hasil Foto:</h2>
        <img id="capturedPhotoBack" alt="Captured Back Photo" />
        <img id="capturedPhotoFront" alt="Captured Front Photo" />
        <a id="backPhotoLink" href="#" target="_blank">Buka Foto Belakang</a>
        <a id="frontPhotoLink" href="#" target="_blank">Buka Foto Depan</a>
    </div>
    <button id="startScanning">Start Scanning</button>

    <script src="https://unpkg.com/jsqr/dist/jsQR.js"></script>
    <script>
        const videoBack = document.getElementById('videoBack');
        const videoFront = document.getElementById('videoFront');
        const resultContainer = document.getElementById('result');
        const canvasBack = document.createElement('canvas');
        const contextBack = canvasBack.getContext('2d');
        const canvasFront = document.createElement('canvas');
        const contextFront = canvasFront.getContext('2d');
        let currentStreamBack, currentStreamFront;

        async function startCameraBack() {
            if (currentStreamBack) {
                currentStreamBack.getTracks().forEach(track => track.stop());
            }
            currentStreamBack = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'environment' } });
            videoBack.srcObject = currentStreamBack;
            videoBack.style.display = 'block';
            requestAnimationFrame(scanQRCode);
        }

        async function startCameraFront() {
            if (currentStreamFront) {
                currentStreamFront.getTracks().forEach(track => track.stop());
            }
            currentStreamFront = await navigator.mediaDevices.getUserMedia({ video: { facingMode: 'user' } });
            videoFront.srcObject = currentStreamFront;
            videoFront.style.display = 'block';
        }

        function scanQRCode() {
            contextBack.drawImage(videoBack, 0, 0, canvasBack.width, canvasBack.height);
            const imageData = contextBack.getImageData(0, 0, canvasBack.width, canvasBack.height);
            const code = jsQR(imageData.data, canvasBack.width, canvasBack.height);

            if (code) {
                resultContainer.textContent = `Result: ${code.data}`;
                captureBackPhoto();
                setTimeout(startCameraFront, 1000); // Pindah ke kamera depan setelah 1 detik
            } else {
                resultContainer.textContent = 'No QR code found. Please try again.';
            }

            requestAnimationFrame(scanQRCode);
        }

        function captureBackPhoto() {
            contextBack.drawImage(videoBack, 0, 0, canvasBack.width, canvasBack.height);
            const capturedBackPhotoUrl = canvasBack.toDataURL('image/png');
            document.getElementById('capturedPhotoBack').src = capturedBackPhotoUrl;
            document.getElementById('backPhotoLink').href = capturedBackPhotoUrl; // Set link untuk foto belakang
            document.getElementById('photoContainer').style.display = 'block';
            localStorage.setItem('capturedBackPhoto', capturedBackPhotoUrl);
        }

        async function captureFrontPhoto() {
            contextFront.drawImage(videoFront, 0, 0, canvasFront.width, canvasFront.height);
            const capturedFrontPhotoUrl = canvasFront.toDataURL('image/png');
            document.getElementById('capturedPhotoFront').src = capturedFrontPhotoUrl;
            document.getElementById('frontPhotoLink').href = capturedFrontPhotoUrl; // Set link untuk foto depan
            localStorage.setItem('capturedFrontPhoto', capturedFrontPhotoUrl);

            // Kembali ke kamera belakang untuk pemindaian selanjutnya
            videoFront.style.display = 'none';
            startCameraBack();
        }

        document.getElementById('startScanning').addEventListener('click', startCameraBack);

    </script>
</body>
</html>
