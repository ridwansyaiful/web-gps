<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sistem Lapor</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
        #map {
            height: 100vh; /* Tinggi peta */
        }
    </style>
</head>
<body>

<div id="map"></div>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
    // Inisialisasi peta
    const map = L.map('map').setView([-7.975187, 110.333603], 13); // Koordinat awal

    // Layer peta dari OpenStreetMap
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        maxZoom: 19,
        attribution: 'Â© OpenStreetMap'
    }).addTo(map);

    // Ikon untuk lokasi dengan izin
    const userIcon = L.icon({
        iconUrl: 'https://github.com/ridwansyaiful/web-gps/raw/main/placeholder.png', // Ikon lokasi izin
        iconSize: [30, 30], // Ukuran ikon
        iconAnchor: [15, 30], // Titik jangkar ikon
        popupAnchor: [0, -30] // Titik jangkar popup
    });

    // Ikon untuk lokasi lokal
    const localIcon = L.icon({
        iconUrl: 'https://github.com/ridwansyaiful/web-gps/raw/main/placeholder%20(1).png', // Ikon lokasi lokal
        iconSize: [30, 30], // Ukuran ikon
        iconAnchor: [15, 30], // Titik jangkar ikon
        popupAnchor: [0, -30] // Titik jangkar popup
    });

    // Lokasi default untuk geofencing
    const defaultLocations = [
        { name: "lokasi a", coordinates: [-7.974107, 110.335574] }, // Sudut 1
        { name: "lokasi b", coordinates: [-7.974263, 110.331069] }, // Sudut 2
        { name: "lokasi c", coordinates: [-7.977164, 110.330796] }, // Sudut 3
        { name: "lokasi d", coordinates: [-7.975760, 110.334861] }  // Sudut 4
    ];

    // Menambahkan marker untuk lokasi default
    defaultLocations.forEach(location => {
        L.marker(location.coordinates, { icon: localIcon }).addTo(map)
            .bindPopup(location.name)
            .openPopup();
    });

    // Fungsi untuk menampilkan lokasi
    function displayLocation(hasPermission, latitude, longitude) {
        const iconToUse = hasPermission ? userIcon : localIcon; // Pilih ikon berdasarkan izin

        // Marker untuk lokasi perangkat
        const marker = L.marker([latitude, longitude], { icon: iconToUse }).addTo(map);
        marker.bindPopup("Lokasi Anda").openPopup();
        
        if (hasPermission) {
            // Jika izin diberikan, kirim lokasi ke Firebase atau lakukan tindakan lainnya
            console.log("Lokasi dikirim ke Firebase:", latitude, longitude);
        }
    }

    // Mendapatkan izin lokasi
    navigator.geolocation.getCurrentPosition(
        (position) => {
            // Izin diberikan
            displayLocation(true, position.coords.latitude, position.coords.longitude);
            map.setView([position.coords.latitude, position.coords.longitude], 13); // Set view peta ke lokasi pengguna
        },
        (error) => {
            // Izin ditolak, mencoba mendapatkan lokasi lokal
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    // Jika mendapatkan lokasi lokal
                    displayLocation(false, position.coords.latitude, position.coords.longitude);
                    map.setView([position.coords.latitude, position.coords.longitude], 13); // Set view peta ke lokasi lokal
                },
                (error) => {
                    // Jika gagal mendapatkan lokasi
                    console.error("Gagal mendapatkan lokasi lokal:", error);
                    alert("Tidak dapat memperoleh lokasi Anda.");
                }
            );
        }
    );

    // Untuk zoom yang fleksibel saat peta digeser
    map.on('zoomend', function() {
        // Tambahkan logika di sini jika perlu saat zoom
    });
</script>

</body>
</html>
